@page "/media"
@model STWiki.Pages.Media.LibraryModel
@{
    ViewData["Title"] = "Media Library";
}

<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-file-earmark-image me-2"></i>Media Library</h2>
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadModal">
            <i class="bi bi-upload me-2"></i>Upload Files
        </button>
    </div>

    <!-- Search and Filters -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="input-group">
                        <input type="text" class="form-control" id="searchInput" placeholder="Search media files...">
                        <button class="btn btn-outline-secondary" type="button" onclick="searchMedia()">
                            <i class="bi bi-search"></i>
                        </button>
                    </div>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="typeFilter" onchange="searchMedia()">
                        <option value="">All Types</option>
                        <option value="image">Images</option>
                        <option value="document">Documents</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="sortOrder" onchange="searchMedia()">
                        <option value="newest">Newest First</option>
                        <option value="oldest">Oldest First</option>
                        <option value="name">Name A-Z</option>
                        <option value="size">File Size</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Media Grid -->
    <div id="mediaGrid" class="row g-3">
        <div class="col-12 text-center">
            <div class="spinner-border text-primary" role="status" id="loadingSpinner">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>

    <!-- Load More -->
    <div class="text-center mt-4">
        <button id="loadMoreBtn" class="btn btn-outline-secondary" onclick="loadMoreMedia()" style="display: none;">
            <i class="bi bi-arrow-down-circle me-2"></i>Load More
        </button>
    </div>

    <!-- No Media Message -->
    <div id="noMediaMessage" class="text-center py-5" style="display: none;">
        <i class="bi bi-file-earmark-image display-1 text-muted"></i>
        <h4 class="mt-3 text-muted">No media files found</h4>
        <p class="text-muted">Upload your first media file to get started!</p>
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadModal">
            <i class="bi bi-upload me-2"></i>Upload Files
        </button>
    </div>
</div>

<!-- Upload Modal -->
<div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="uploadModalLabel">Upload Media Files</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Drag and Drop Zone -->
                <div id="dropzone" class="border-2 border-dashed border-secondary rounded p-5 text-center mb-3">
                    <i class="bi bi-cloud-upload display-4 text-muted mb-3 d-block"></i>
                    <h5>Drag and drop files here</h5>
                    <p class="text-muted">or click to browse files</p>
                    <input type="file" id="fileInput" multiple class="form-control" style="display: none;" accept="image/*,.pdf,.txt,.md,.docx,.pptx">
                    <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('fileInput').click()">
                        Choose Files
                    </button>
                </div>

                <!-- Upload Progress -->
                <div id="uploadProgress" style="display: none;">
                    <div class="progress mb-3">
                        <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                    </div>
                    <div id="uploadStatus" class="text-center"></div>
                </div>

                <!-- File List -->
                <div id="fileList"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="uploadBtn" onclick="uploadFiles()" disabled>
                    Upload Files
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Media Details Modal -->
<div class="modal fade" id="mediaDetailsModal" tabindex="-1" aria-labelledby="mediaDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-light">
                <h5 class="modal-title" id="mediaDetailsModalLabel">
                    <i class="bi bi-file-earmark-image text-primary me-2"></i>Media Details
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4" id="mediaDetailsContent">
                <!-- Content will be loaded dynamically -->
            </div>
            <div class="modal-footer bg-light">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle me-1"></i>Close
                </button>
                <button type="button" class="btn btn-primary" onclick="saveMediaDetails()">
                    <i class="bi bi-save me-1"></i>Save Changes
                </button>
                <button type="button" class="btn btn-danger" onclick="deleteMediaFile()">
                    <i class="bi bi-trash me-1"></i>Delete
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/media-library.js"></script>
}